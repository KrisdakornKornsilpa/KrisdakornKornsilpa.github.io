<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta property="og:title" content="Hofkrisda share content">
  <meta property="og:image" content="https://image.makewebcdn.com/makeweb/0/pMrtkmxgt/gif_animation/garfield_w200.gif?v=202405291424">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style type="text/css"> 
        body { 
            font-family: 'line_seed_sans_th'; 
        } 
    </style>
    <title>LIFF Dynamic link Keyword x Dropdown Sheet</title>
</head>
<body>
<p> <p>
<center> . . . . . ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î . . . . .</center>
<center>
  <img src="https://image.makewebcdn.com/makeweb/0/pMrtkmxgt/gif_animation/lt47_2.gif?v=202405291424" alt="loading" height="120" />
  <BR>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà
  </p></p></center>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <script>
        $(document).ready(function () {
            var liffId = "1655425003-TPe9y1TW"; //--‡πÉ‡∏™‡πà LiffID--
            initializeLiff(liffId);
           
        })

        function initializeLiff(liffId) {
            liff
                .init({
                    liffId: liffId,
                    withLoginOnExternalBrowser: true,
                })
                .then(() => {
                    if (!liff.isInClient() && !liff.isLoggedIn()) {
                        window.alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
                        liff.login({ redirectUri: location.href });

                    }
                    liff.ready.then(() => {
                      liff.getProfile()
  .then((profile) => {
    const name = profile.displayName;
    const userId = profile.userId;
    const params = (new URL(document.location)).searchParams;
    const key = params.get("key");
             
    sendToGoogleSheet(userId, name, key)
  })
  .catch((err) => {
    console.log("error", err);
  });                   
                       
                    });
                })
                .catch((err) => {
                    console.log('LIFF Initialization failed ', err);
                });
        }

        function sendToGoogleSheet(userId, name,key) {
      //  $('#loading-overlay').removeClass('hidden');
        $.post('https://script.google.com/macros/s/AKfycbxeKrof3DhtbzZGW0OtISVUbl1vi2TzO8AZUiSeZ8KPEHymZ-3sqWD8IQASzjVTAOI/exec', {
//-----‡πÄ‡∏ß‡πá‡∏õ‡πÅ‡∏≠‡∏õ‡∏à‡∏≤‡∏Å google sheet--------
            userId: userId, 
            name: name, 
            key: key
        })
        .done(function(response) {
         //   $('#loading-overlay').addClass('hidden');
            var statusCode = response.statusCode;
            console.log("Status code from response:", statusCode);
                  if (statusCode === 200) {
                var flexMessage = response.body;
          //--sendMessages(flexMessage); ‡πÉ‡∏ä‡πâ send ‡∏´‡∏£‡∏∑‡∏≠ share ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ--
                shareMessages(flexMessage);
            } else {
                Swal.fire("‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "error")
                    .then(() => liff.closeWindow());
            }
        })
        .fail(function(error) {
            console.error("Error sending to Google Sheet:", error);
            $('#loading-overlay').addClass('hidden');
            Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "error")
                .then(() => liff.closeWindow());
        });
    }
    //   function sendMessages(messages) {
    //     if (!liff.isInClient()) {
    //        Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "error")
    //         console.error("LIFF is not opened inside the LINE app.");
    //         return;
    //     }

    //     liff.sendMessages(messages)
    //         .then(() => {
    //             Swal.fire({
    //                 title: "üéâ‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢üéâ",
    //                 text: "‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Message ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
    //                 icon: "success",
    //                 confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
    //             }).then(() => {
    //                 liff.closeWindow();
    //             });
    //         })
    //         .catch(error => {
    //             console.error("Failed to send message:", error);
    //             Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!", "‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "error")
    //                 .then(() => liff.closeWindow());
    //         });
    // }
      
      function shareMessages(messages) {
        if (!liff.isInClient()) {
           Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", "error")
            console.error("LIFF is not opened inside the LINE app.");
            return;
        }

        liff.shareTargetPicker(messages).then(function (res) {
    if (res) {
        Swal.fire({
                    title: "üéâ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢üéâ",
                    text: "‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Message ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
                    icon: "success",
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                }).then(() => {
                    liff.closeWindow();
                });
    } else {
     
      console.log("TargetPicker was closed!");
    }
  })
  .catch(function (error) {
    
    console.log("something wrong happen");
          Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!", "‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "error")
                    .then(() => liff.closeWindow());
  });
           
    }
      

    </script>
</body>
</html>
